<!DOCTYPE HTML>
<html lang="zh-Hans" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Generic Types, Traits, and Lifetimes 泛型、特质与生命周期 - Rust 编程语言</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="ferris.css">
        <link rel="stylesheet" href="theme/2018-edition.css">
        <link rel="stylesheet" href="theme/semantic-notes.css">
        <link rel="stylesheet" href="theme/listing.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust 编程语言</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="generic-types-traits-and-lifetimes-泛型特质与生命周期"><a class="header" href="#generic-types-traits-and-lifetimes-泛型特质与生命周期">Generic Types, Traits, and Lifetimes 泛型、特质与生命周期</a></h1>
<p>Every programming language has tools for effectively handling the duplication
of concepts. In Rust, one such tool is <em>generics</em>: abstract stand-ins for
concrete types or other properties. We can express the behavior of generics or
how they relate to other generics without knowing what will be in their place
when compiling and running the code.</p>
<p>每种编程语言都有高效处理概念重复的工具。在 Rust 中，这类工具之一就是<em>泛型</em>（generics）：具体类型或其他属性的抽象占位符。我们可以在编译和运行代码时无需知晓实际类型的情况下，表达泛型的行为或它们与其他泛型的关系。</p>
<p>Functions can take parameters of some generic type, instead of a concrete type
like <code>i32</code> or <code>String</code>, in the same way they take parameters with unknown
values to run the same code on multiple concrete values. In fact, we’ve already
used generics in Chapter 6 with <code>Option&lt;T&gt;</code>, in Chapter 8 with <code>Vec&lt;T&gt;</code> and
<code>HashMap&lt;K, V&gt;</code>, and in Chapter 9 with <code>Result&lt;T, E&gt;</code>. In this chapter, you’ll
explore how to define your own types, functions, and methods with generics!</p>
<p>函数可以接收泛型类型的参数（而非像 <code>i32</code> 或 <code>String</code> 这样的具体类型），就像函数接收未知值的参数以便在多个具体值上运行相同代码那样。实际上，我们在第 6 章的 <code>Option&lt;T&gt;</code>、第 8 章的 <code>Vec&lt;T&gt;</code> 和 <code>HashMap&lt;K, V&gt;</code>，以及第 9 章的 <code>Result&lt;T, E&gt;</code> 中已经使用过泛型。本章将探索如何用泛型定义你自己的类型、函数和方法！</p>
<p>First we’ll review how to extract a function to reduce code duplication. We’ll
then use the same technique to make a generic function from two functions that
differ only in the types of their parameters. We’ll also explain how to use
generic types in struct and enum definitions.</p>
<p>首先我们将回顾如何提取函数以减少代码重复。接着用相同技术，从两个仅在参数类型上不同的函数中创建泛型函数。还会解释如何在结构体和枚举定义中使用泛型类型。</p>
<p>Then you’ll learn how to use <em>traits</em> to define behavior in a generic way. You
can combine traits with generic types to constrain a generic type to accept
only those types that have a particular behavior, as opposed to just any type.</p>
<p>然后你将学习使用<em>特质</em>（traits）以泛型方式定义行为。可以将特质与泛型类型结合，约束泛型类型只接受具有特定行为的类型，而非任意类型。</p>
<p>Finally, we’ll discuss <em>lifetimes</em>: a variety of generics that give the
compiler information about how references relate to each other. Lifetimes allow
us to give the compiler enough information about borrowed values so that it can
ensure references will be valid in more situations than it could without our
help.</p>
<p>最后，我们将讨论<em>生命周期</em>（lifetimes）：一种向编译器提供引用间关系信息的泛型。生命周期允许我们为借用值提供足够信息，使编译器能在更多场景中确保引用有效性。</p>
<h2 id="removing-duplication-by-extracting-a-function-通过提取函数消除重复"><a class="header" href="#removing-duplication-by-extracting-a-function-通过提取函数消除重复">Removing Duplication by Extracting a Function 通过提取函数消除重复</a></h2>
<p>Generics allow us to replace specific types with a placeholder that represents
multiple types to remove code duplication. Before diving into generics syntax,
let’s first look at how to remove duplication in a way that doesn’t involve
generic types by extracting a function that replaces specific values with a
placeholder that represents multiple values. Then we’ll apply the same
technique to extract a generic function! By looking at how to recognize
duplicated code you can extract into a function, you’ll start to recognize
duplicated code that can use generics.</p>
<p>泛型允许我们用代表多种类型的占位符替换特定类型，从而消除代码重复。在深入泛型语法之前，先看如何通过提取函数（将特定值替换为代表多个值的占位符）来消除重复。然后将应用相同技术提取泛型函数！通过识别可提取到函数中的重复代码，你会开始识别可使用泛型的重复代码。</p>
<p>We’ll begin with the short program in Listing 10-1 that finds the largest
number in a list.</p>
<p>我们从示例 10-1 的简短程序开始，它查找列表中的最大数。</p>
<figure class="listing" id="listing-10-1">
<span class="file-name">Filename: src/main.rs</span>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let number_list = vec![34, 50, 25, 100, 65];

    let mut largest = &amp;number_list[0];

    for number in &amp;number_list {
        if number &gt; largest {
            largest = number;
        }
    }

    println!("The largest number is {largest}");
<span class="boring">    assert_eq!(*largest, 100);
</span>}</code></pre></pre>
<figcaption><a href="#listing-10-1">Listing 10-1</a>: Finding the largest number in a list of numbers 在数字列表中查找最大数</figcaption>
</figure>
<p>We store a list of integers in the variable <code>number_list</code> and place a reference
to the first number in the list in a variable named <code>largest</code>. We then iterate
through all the numbers in the list, and if the current number is greater than
the number stored in <code>largest</code>, we replace the reference in that variable.
However, if the current number is less than or equal to the largest number seen
so far, the variable doesn’t change, and the code moves on to the next number
in the list. After considering all the numbers in the list, <code>largest</code> should
refer to the largest number, which in this case is 100.</p>
<p>我们将整数列表存入变量 <code>number_list</code>，并将列表中第一个数字的引用存入变量 <code>largest</code>。然后遍历列表中所有数字，若当前数字大于 <code>largest</code> 中的值，则替换该变量的引用。若当前数字小于或等于已见最大值，变量保持不变，代码继续处理下一个数字。处理完所有数字后，<code>largest</code> 应指向最大数（此处为 100）。</p>
<p>We’ve now been tasked with finding the largest number in two different lists of
numbers. To do so, we can choose to duplicate the code in Listing 10-1 and use
the same logic at two different places in the program, as shown in Listing 10-2.</p>
<p>现在我们需要在两个不同数字列表中查找最大值。为此可选择复制示例 10-1 的代码，在程序中两处不同位置使用相同逻辑，如示例 10-2 所示。</p>
<figure class="listing" id="listing-10-2">
<span class="file-name">Filename: src/main.rs</span>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let number_list = vec![34, 50, 25, 100, 65];

    let mut largest = &amp;number_list[0];

    for number in &amp;number_list {
        if number &gt; largest {
            largest = number;
        }
    }

    println!("The largest number is {largest}");

    let number_list = vec![102, 34, 6000, 89, 54, 2, 43, 8];

    let mut largest = &amp;number_list[0];

    for number in &amp;number_list {
        if number &gt; largest {
            largest = number;
        }
    }

    println!("The largest number is {largest}");
}</code></pre></pre>
<figcaption><a href="#listing-10-2">Listing 10-2</a>: Code to find the largest number in <em>two</em> lists of numbers 在两个数字列表中查找最大数的代码</figcaption>
</figure>
<p>Although this code works, duplicating code is tedious and error prone. We also
have to remember to update the code in multiple places when we want to change
it.</p>
<p>虽然代码可用，但复制代码冗长且易错。修改时还需记住更新多处代码。</p>
<p>To eliminate this duplication, we’ll create an abstraction by defining a
function that operates on any list of integers passed in as a parameter. This
solution makes our code clearer and lets us express the concept of finding the
largest number in a list abstractly.</p>
<p>为消除重复，我们通过定义函数来创建抽象，该函数操作传入的任意整数列表参数。此方案使代码更清晰，并抽象表达了“在列表中查找最大值“的概念。</p>
<p>In Listing 10-3, we extract the code that finds the largest number into a
function named <code>largest</code>. Then we call the function to find the largest number
in the two lists from Listing 10-2. We could also use the function on any other
list of <code>i32</code> values we might have in the future.</p>
<p>在示例 10-3 中，将查找最大值的代码提取到名为 <code>largest</code> 的函数中。然后用该函数处理示例 10-2 的两个列表。未来也可将此函数用于任何其他 <code>i32</code> 值列表。</p>
<figure class="listing" id="listing-10-3">
<span class="file-name">Filename: src/main.rs</span>
<pre><pre class="playground"><code class="language-rust">fn largest(list: &amp;[i32]) -&gt; &amp;i32 {
    let mut largest = &amp;list[0];

    for item in list {
        if item &gt; largest {
            largest = item;
        }
    }

    largest
}

fn main() {
    let number_list = vec![34, 50, 25, 100, 65];

    let result = largest(&amp;number_list);
    println!("The largest number is {result}");
<span class="boring">    assert_eq!(*result, 100);
</span>
    let number_list = vec![102, 34, 6000, 89, 54, 2, 43, 8];

    let result = largest(&amp;number_list);
    println!("The largest number is {result}");
<span class="boring">    assert_eq!(*result, 6000);
</span>}</code></pre></pre>
<figcaption><a href="#listing-10-3">Listing 10-3</a>: Abstracted code to find the largest number in two lists 查找两个列表中最大值的抽象代码</figcaption>
</figure>
<p>The <code>largest</code> function has a parameter called <code>list</code>, which represents any
concrete slice of <code>i32</code> values we might pass into the function. As a result,
when we call the function, the code runs on the specific values that we pass
in.</p>
<p><code>largest</code> 函数有个 <code>list</code> 参数，代表可能传入的任意具体 <code>i32</code> 切片。因此调用函数时，代码会针对传入的具体值运行。</p>
<p>In summary, here are the steps we took to change the code from Listing 10-2 to
Listing 10-3:</p>
<p>总结从示例 10-2 改为 10-3 的步骤：</p>
<ul>
<li>Identify duplicate code.</li>
<li>识别重复代码</li>
<li>Extract the duplicate code into the body of the function, and specify the
inputs and return values of that code in the function signature.</li>
<li>将重复代码提取到函数体，并在函数签名中指定输入输出</li>
<li>Update the two instances of duplicated code to call the function instead.</li>
<li>更新重复代码处改为调用函数</li>
</ul>
<p>Next, we’ll use these same steps with generics to reduce code duplication. In
the same way that the function body can operate on an abstract <code>list</code> instead
of specific values, generics allow code to operate on abstract types.</p>
<p>接下来我们将用泛型通过相同步骤减少代码重复。如同函数体能操作抽象 <code>list</code> 而非具体值，泛型允许代码操作抽象类型。</p>
<p>For example, say we had two functions: one that finds the largest item in a
slice of <code>i32</code> values and one that finds the largest item in a slice of <code>char</code>
values. How would we eliminate that duplication? Let’s find out!</p>
<p>例如有两个函数：一个在 <code>i32</code> 切片中查找最大值，另一个在 <code>char</code> 切片中查找最大值。如何消除重复？让我们一探究竟！</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="ch09-03-to-panic-or-not-to-panic.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="ch10-01-syntax.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="ch09-03-to-panic-or-not-to-panic.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="ch10-01-syntax.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="ferris.js"></script>



    </div>
    </body>
</html>
